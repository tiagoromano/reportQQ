!function(o){angular.module("custom.controllers",[]),app.controller("LoginController",["$scope","$http","$location","$rootScope","$window","$state","$translate","Notification","$ionicLoading","$timeout","$stateParams","$ionicModal",function(o,e,n,t,r,s,i,a,l,c,p,u){function d(o,e,n,t){"undefined"!=typeof Storage&&sessionStorage.setItem("_u",JSON.stringify(o)),s.go("app.home"),c(function(){l.hide()},500)}function f(o,e,n,t){var r=401==e?i.instant("Login.view.invalidPassword"):o;r||(r=i.instant("General.ErrorNotSpecified")),console.log(r),l.hide(),a.error(r)}app.registerEventsCronapi(o,i,u),t.http=e,o.Notification=a;for(var w in app.userEvents)o[w]=app.userEvents[w].bind(o);o.user={username:"",password:""},o.message={},o.login=function(){l.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o.message.error=void 0,window.hostApp?e({method:"POST",url:window.hostApp+"auth",data:$.param(o.user),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(d).error(f):(l.hide(),a.error("HostApp is required!"))},t.infiniteReached=function(){}}]),app.controller("HomeController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal",function(o,e,n,t,r,s,i,a,l){function c(){e({method:"GET",url:window.hostApp+"auth/refresh"}).success(function(o,e,n,t){console.log("revive :",new Date(o.expires)),sessionStorage.setItem("_u",JSON.stringify(o)),setTimeout(function(){c()},18e5)}).error(function(){})}app.registerEventsCronapi(o,s,l),n.http=e,o.Notification=i;for(var p in app.userEvents)o[p]=app.userEvents[p].bind(o);l.fromTemplateUrl("views/logged/_changepassword.view.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e}),o.openChangePassword=function(){o.modal.show()},o.closeChangePassword=function(){o.modal.hide()},o.shouldShowDelete=!1,o.shouldShowReorder=!1,o.listCanSwipe=!0,o.message={},o.selecionado={valor:1},n.session=sessionStorage._u?JSON.parse(sessionStorage._u):null,n.session||("undefined"!=typeof Storage?sessionStorage.removeItem("_u"):t.go("login")),n.logout=function(){n.session={},"undefined"!=typeof Storage&&sessionStorage.removeItem("_u"),t.go("login")},o.changePassword=function(){function n(o,e,n,t){i.info(s.instant("Home.view.passwordChanged")),r()}function t(o,e,n,t){var r=e>=401?s.instant("Home.view.InvalidPassword"):o;i.error(r)}function r(){oldPassword.value="",newPassword.value="",newPasswordConfirmation.value="",o.closeChangePassword()}var a={oldPassword:oldPassword.value,newPassword:newPassword.value,newPasswordConfirmation:newPasswordConfirmation.value};e({method:"POST",url:window.hostApp+"changePassword",data:$.param(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(n).error(t)},n.session?n.session.token&&c():o.ignoreAuth?"undefined"!=typeof Storage&&sessionStorage.removeItem("_u"):t.go("login")}]),app.controller("PublicController",["$controller","$scope",function(o,e){e.ignoreAuth=!0,angular.extend(this,o("HomeController",{$scope:e}))}]),app.controller("chatController",["$scope","$state","$ionicPopup","$ionicScrollDelegate","$timeout","$interval","$ionicModal","$translate","$rootScope","$http","Notification",function(o,e,n,t,r,s,i,a,l,c,p){app.registerEventsCronapi(o,a),l.http=c,o.Notification=p;for(var u in app.userEvents)o[u]=app.userEvents[u].bind(o);var d,f,w,g=(JSON.parse(sessionStorage._u).user.username,t.$getByHandle("userMessageScroll"));o.enter=function(){r(function(){d=document.body.querySelector(".homeView .bar-footer"),f=document.body.querySelector(".homeView .scroll-content"),w=angular.element(d.querySelector("textarea"))},0)},o.isEnter=function(o){13==o.keyCode&&r(function(){o.stopPropagation(),$("#sendButton").trigger("click")},0)},o.refreshScroll=function(e,n){r(function(){e=e||o.scrollDown,g.resize(),e&&g.scrollBottom(!0),o.checkScroll()},n||1e3)},o.scrollDown=!0,o.checkScroll=function(){return r(function(){var e=g.getScrollPosition().top,n=g.getScrollView().__maxScrollTop;o.scrollDown=e>=n,o.$apply()},0),!0}}])}(app),window.safeApply=function(o){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?o&&"function"==typeof o&&o():this.$apply(o)};